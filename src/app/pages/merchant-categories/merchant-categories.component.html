<app-navbar></app-navbar>

<div class="container">
  <div class="breadcrumb">
    <a routerLink="/business-params">Business Parameters</a>
    <span class="breadcrumb-separator">&gt;</span>
    <span class="breadcrumb-current">Merchant Categories</span>
  </div>

  <div class="page-header">
    <h1>Merchant Categories Management</h1>
    <button class="btn-primary" (click)="openCreateModal()">Add New</button>
  </div>

  <!-- Search and Filter -->
  <div class="search-filters">
    <div class="filter-controls">
      <input type="text" placeholder="Merchant Category Code"
             [(ngModel)]="searchTerm">
      <select [(ngModel)]="statusFilter">
        <option value="">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
      <select [(ngModel)]="riskFilter">
        <option value="">All Risk Levels</option>
        <option value="low">Low Risk</option>
        <option value="medium">Medium Risk</option>
        <option value="high">High Risk</option>
      </select>
      <button class="btn-primary" (click)="filter()">Search</button>
      <button class="btn-secondary" (click)="clearFilters()">Clear</button>
    </div>
  </div>

  <div class="users-table">
    <table>
      <thead>
        <tr>
          <th>Code</th>
          <th>Name</th>
          <th>Description</th>
          <th>Risk Level</th>
          <th>Status</th>
          <th>Created Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cat of categories">
          <td>{{ cat.code }}</td>
          <td>{{ cat.name }}</td>
          <td>{{ cat.description || '-' }}</td>
          <td><span [class]="'risk-' + cat.riskLevel">{{ cat.riskLevel | titlecase }} Risk</span></td>
          <td><span [class]="'status-' + cat.status">{{ cat.status | titlecase }}</span></td>
          <td>{{ formatDate(cat.createdAt) }}</td>
          <td>
            <button class="btn-small" (click)="editItem(cat.id)">Edit</button>
            <button class="btn-small btn-danger" (click)="deleteItem(cat.id)">Delete</button>
          </td>
        </tr>
        <tr *ngIf="categories.length === 0">
          <td colspan="7" style="text-align: center; padding: 2rem;">No merchant categories found.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Create/Edit Modal -->
<div *ngIf="showModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>{{ modalTitle }}</h3>
      <span class="close" (click)="closeModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form>
        <div class="form-row">
          <div class="form-group">
            <label for="mcCode">Code *</label>
            <input type="text" id="mcCode" [(ngModel)]="form.code" name="code"
                   required maxlength="10" style="text-transform: uppercase;" placeholder="e.g., RET, ECM, SRV"
                   [disabled]="codeDisabled"
                   (focus)="codeTouched = true"
                   (ngModelChange)="validateCode()"
                   [class.input-error]="codeError">
            <small class="error-text" *ngIf="codeError">{{ codeError }}</small>
          </div>
          <div class="form-group">
            <label for="mcStatus">Status:</label>
            <select id="mcStatus" [(ngModel)]="form.status" name="status">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="mcName">Name *</label>
            <input type="text" id="mcName" [(ngModel)]="form.name" name="name"
                   required placeholder="e.g., Retail, E-commerce"
                   (focus)="nameTouched = true"
                   (ngModelChange)="validateName()"
                   [class.input-error]="nameError">
            <small class="error-text" *ngIf="nameError">{{ nameError }}</small>
          </div>
          <div class="form-group">
            <label for="mcRisk">Risk Level *</label>
            <select id="mcRisk" [(ngModel)]="form.riskLevel" name="riskLevel" required
                    (focus)="riskLevelTouched = true"
                    (ngModelChange)="validateRiskLevel()"
                    [class.input-error]="riskLevelError">
              <option value="">Select Risk Level</option>
              <option value="low">Low Risk</option>
              <option value="medium">Medium Risk</option>
              <option value="high">High Risk</option>
            </select>
            <small class="error-text" *ngIf="riskLevelError">{{ riskLevelError }}</small>
          </div>
        </div>
        <div class="form-group">
          <label for="mcDescription">Description *</label>
          <textarea id="mcDescription" [(ngModel)]="form.description" name="description"
                    rows="3" placeholder="Describe this merchant category..."
                    (focus)="descriptionTouched = true"
                    (ngModelChange)="validateDescription()"
                    [class.input-error]="descriptionError"></textarea>
          <small class="error-text" *ngIf="descriptionError">{{ descriptionError }}</small>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" (click)="closeModal()" class="btn-secondary">Cancel</button>
      <button type="button" (click)="save()" class="btn-primary" [disabled]="hasFormErrors">Save Category</button>
    </div>
  </div>
</div>
